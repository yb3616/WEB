<template>
    <v-app>
        <v-navigation-drawer v-model="drawer" fixed app clipped class="grey lighten-4">
            <v-list class="pt-0" dense>
                <v-list-tile v-for="item in this.$store.state.runtime.left_items" :key="item.title" @click="">
                    <v-list-tile-action>
                        <v-icon>{{ item.icon }}</v-icon>
                    </v-list-tile-action>
                    <v-list-tile-content>
                        <v-list-tile-title>{{ item.title }}</v-list-tile-title>
                    </v-list-tile-content>
                </v-list-tile>
            </v-list>
        </v-navigation-drawer>

        <v-toolbar dark color="primary" v-if="isShow()" fixed app clipped-left>
            <v-toolbar-side-icon @click.stop="drawer = !drawer"></v-toolbar-side-icon>
            <v-toolbar-title class="white--text">MY WEBSITE</v-toolbar-title>
            <v-spacer></v-spacer>
            <v-btn icon>
                <v-menu transition="slide-y-transition" bottom>
                    <v-btn slot="activator" dark icon>
                        <v-icon>{{ this.$store.state.runtime.icon }}</v-icon>
                    </v-btn>
                    <v-list>
                        <v-list-tile
                            v-for="(item, i) in this.$store.state.runtime.icon_btns"
                            :key="i"
                            @click="go2(item.url)"
                            >
                            <v-list-tile-title>{{ item.title }}</v-list-tile-title>
                        </v-list-tile>
                    </v-list>
                </v-menu>
            </v-btn>
        </v-toolbar>

        <div style="height:64px; width:100%;"></div>
        <router-view></router-view>

        <v-footer class="pa-3" absolute>
            <v-spacer></v-spacer>
            <div>&copy; {{ new Date().getFullYear() }}</div>
        </v-footer>

        <v-dialog
            v-model="dialog"
            max-width="290"
            >
            <v-card>
                <v-card-title class="headline">警告</v-card-title>

                <v-card-text>确定退出登录？</v-card-text>

                <v-card-actions>
                    <v-spacer></v-spacer>

                    <v-btn
                        color="green darken-1"
                        flat="flat"
                        @click="dialog = false"
                        >取消操作</v-btn>

                    <v-btn
                        color="error darken-1"
                        flat="flat"
                        @click="logout"
                        >确定退出</v-btn>
                </v-card-actions>
            </v-card>
        </v-dialog>
    </v-app>
</template>

<script>
import _ from 'lodash';
export default {
    name: 'App',
    data() {
        return {
            dialog: false,
            drawer: false,
        };
    },
    mounted() {
        this.$store.commit("logout")
        this.$http.get("/user/info").then( result => {
            if ("success" == result.data.msg) {
                this.$store.commit('login', result.data.result)
            } else {
                console.log(result);
            }
        }).catch( err => {
            console.log(err);
        })
    },
    methods: {
        isShow() {
            let colls = ['Login', 'Register'];
            return !_.includes(colls, this.$router.history.current.name);
        },
        toIndex() {
            this.$router.push('/')
        },
        go2(url) {
            if (url != '/logout') {
                this.$router.push(url);
            } else {
                this.dialog = true
            }
        },
        logout() {
            this.$http.get('/logout').then( resp => {
                if (resp.data.msg == "success") {
                    this.$store.commit("logout");
                    this.dialog = false;
                }
            }).catch( err => {
                console.log(err);
            } );
        },
    },
};
</script>
